//---------------------------------------------------------------------------

#include <vcl.h>
#pragma hdrstop
#include "publicf.h"

#include "Support.h"
#include "Main.h"
//---------------------------------------------------------------------------
#pragma package(smart_init)
#pragma link "RzCmboBx"
#pragma link "RzPanel"
#pragma link "RzEdit"
#pragma link "AdvEdit"
#pragma link "AeroButtons"
#pragma resource "*.dfm"
TFSupport *FSupport;
//---------------------------------------------------------------------------
__fastcall TFSupport::TFSupport(TComponent* Owner)
	: TForm(Owner)
{
}
//---------------------------------------------------------------------------
void __fastcall TFSupport::btnSendClick(TObject *Sender)
{
	if(txtName->Text.Trim() == "" ||  txtEmail->Text.Trim() == "")
	{
		ShowMessageA("ÇáÑÌÇÁ ÊÚÈÆÉ ÍÞá ÇáÇÓã æ ÍÞá ÇáÈÑíÏ ÇáÅáßÊÑæäí");
		return;
	}

	TOSVersion *ver;

	AnsiString winver = ver->Major + " / " + ver->Name + " / " + ver->Minor + " / " + ver->Build + " / " + ver->ServicePackMajor;
	this->Cursor = crAppStart;

	IdSMTP1->Username = "support@astorm.net";
	IdSMTP1->Password = "#amsco100";
	IdSMTP1->Host = "astorm.net";
	IdSMTP1->Port = 25;

	TIdMessage *IdMessage1 = new  TIdMessage(NULL);

	AnsiString msg1 = "";
	msg1 = msg1 + " ÇáÇÓã : " + txtName->Text + "<br>";
	msg1 = msg1 + " ÇáÈÑíÏ ÇáÅáßÊÑæäí : " + txtName->Text + "<br>";
	msg1 = msg1 + " ÑÞã ÇáãæÈÇíá : " + txtMobile->Text + "<br>";
	msg1 = msg1 + " äÕ ÇáÑÓÇáÉ : " +
	StringReplace(txtComment->Text.Trim(), "\n", "<br>",TReplaceFlags() << rfReplaceAll) + "<br>";


	IdMessage1->ContentType = "text/html";
	IdMessage1->Encoding = meMIME;


	IdMessage1->CharSet = "windows-1256";
	IdMessage1->Subject = "ÏÚã Ýäí áÈÑäÇãÌ ÇáÃÑÔíÝ ÇáãÍáí";
	IdMessage1->Body->Add(msg1);

	IdMessage1->From->Text = "support@astorm.net";
	IdMessage1->From->Name = txtName->Text;
	IdMessage1->Recipients->EMailAddresses = "support@astorm.net";


	try {
		IdSMTP1->Connect();
		IdSMTP1->Authenticate();

		IdSMTP1->Send(IdMessage1);
		ShowMessageA("Êã ÅÑÓÇá ÇáãÚáæãÇÊ ááÏÚã ÇáÝäí");
		IdSMTP1->Disconnect();
		this->Cursor = crDefault;


			AnsiString VChanges = "";
			VChanges = VChanges + " Êã ÅÑÓÇá ÏÚã Ýäí ÈÇáäÕ ÇáÊÇáí  : \n" + "[[" + txtComment->Text.Trim()  + "]]" + "\n";
			//SaveLog("14","11",VChanges);


	}
	catch(Exception &e)
	{
	  ShowMessage("ÍÏËÊ ãÔßáÉ ÃËäÇÁ ÇáÇÊÕÇá ÈÇáÅäÊÑäÊ - ÇáÑÌÇÁ ÇáÊÃßÏ ãä ÇÊÕÇáß ÈÇáÅäÊÑäÊ Ëã ÃÚÏ ÇáãÍÇæáÉ");
	  this->Cursor = crDefault;
	  return;
	}

	Close();
}
//---------------------------------------------------------------------------

void __fastcall TFSupport::txtSchoolNameEnter(TObject *Sender)
{
	ChangeLanguage("A");
}
//---------------------------------------------------------------------------
void __fastcall TFSupport::txtEmailEnter(TObject *Sender)
{
	ChangeLanguage("E");
}
//---------------------------------------------------------------------------

void __fastcall TFSupport::txtAdminNameEnter(TObject *Sender)
{
	ChangeLanguage("A");
}
//---------------------------------------------------------------------------
void __fastcall TFSupport::txtNameEnter(TObject *Sender)
{
	ChangeLanguage("A");
}
//---------------------------------------------------------------------------

void __fastcall TFSupport::AdvEdit1Enter(TObject *Sender)
{
	ChangeLanguage("E");
}
//---------------------------------------------------------------------------

void __fastcall TFSupport::txtCommentEnter(TObject *Sender)
{
    ChangeLanguage("A");
}
//---------------------------------------------------------------------------

void __fastcall TFSupport::btnExitClick(TObject *Sender)
{
	Close();
}
//---------------------------------------------------------------------------

